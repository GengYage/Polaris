<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Ephemera</title>
    <link rel="stylesheet" href="css/font.css"/>
    <link rel="stylesheet" href="css/page-header.css"/>
    <link rel="stylesheet" href="css/page-cotent.css"/>
    <link rel="stylesheet" href="css/body.css"/>
    <link rel="stylesheet" href="css/responsive.css"/>
    <link rel="stylesheet" href="css/aside.css"/>
    <link rel="stylesheet" href="css/footer.css"/>

    <script src="js/vue.js" type="text/javascript"></script>
    <script src="vditor/method.min.js" type="text/javascript"></script>
    <script src="js/axios.js" type="text/javascript"></script>
    <link rel="stylesheet" href="vditor/index.css"/>
    <script src="https://cdn.bootcdn.net/ajax/libs/jquery/3.5.1/jquery.js"></script>
</head>

<body>
<nav style="background-image: url(images/aboutbg.png); height: 30vh">
    <!-- 导航栏 -->
    <div id="page-header">
        <span class="logo"><a href="#">SEULG</a></span>

        <div class="toggle-menu">
          <span class="menus_item">
            <a href="#"><i class="iconfont icon-search"></i></a>
          </span>
            <input type="checkbox" id="toggle"/>
            <label for="toggle">
                <div class="hanbao">
                    <div class="menu-icon-first"></div>
                    <div class="menu-icon-second"></div>
                    <div class="menu-icon-third"></div>
                </div>
            </label>
            <div class="main-menu">
            <span class="menus_item">
              <a href="#"><i class="iconfont icon-search"></i>搜索</a>
              <a href="#"><i class="iconfont icon-biaoqian"></i>标签</a>
              <a href="#"><i class="iconfont icon-fenlei"></i>分类</a>
              <a href="#"><i class="iconfont icon-htmal5icon06"></i>主页</a>
              <a href="#"><i class="iconfont icon-youlian"></i>友链</a>
              <a href="#"><i class="iconfont icon-liuyan"></i>留言</a>
              <a href="register.html"
              ><i class="iconfont icon-guanyuwomen"></i>登陆</a
              >
            </span>
            </div>
        </div>
    </div>
</nav>

<div class="content-outer">
    <div class="content-inner" id="article">
        <div class="recent-post" style="width: 80% ;margin-top: 20px">
            <div style="width:100%;height: 100%">
                <div id="EditorPreview"></div>
            </div>
        </div>
        <div class="aside_content" v-if="flag" style="width: 20%;position: fixed;right: 50px">
            <div class="card-widget card-announcement">
                <div class="card-content" id="outline"></div>
            </div>
        </div>
    </div>
</div>


<footer>
    <div id="footer">
        <div class="copyright">
            ©2019 - 2020
            <a href="">By Seulg</a>
        </div>
        <div class="framework-info">
        <span>
          Power by
        </span>
            <a href="">
                Spring
            </a>
            <span>|</span>
            <span>Modified by</span>
            <a href="">Seulg</a>
        </div>

    </div>
</footer>


<div class="go-up-warp">
    <i class="iconfont icon-shang"></i>
</div>

<script type="text/javascript" src="js/nav.js"></script>
<script>

    let article = new Vue({
        el: "#article",
        data: {
            contentEditor: "",
            item: {content: "loading..."},
            flag: true,
        },
        methods: {
            async getDetails() {
                axios({
                    url: "http://localhost:8080/article/10",
                    method: "get",
                }).then(res => {
                    article.item.content = res.data.content;
                    console.log("数据请求完成");
                }).catch(err => alert(err))
            },
            //渲染文章本体
            async renderMarkdown(md) {
                console.log("开始渲染")
                await Vditor.preview(document.getElementById('EditorPreview'), md, {
                    anchor: 1, math: {
                        "inlineDigit": true,
                        engine: "MathJax",
                        macros: {
                            "bf": "{\\boldsymbol f}",
                            "bu": "{\\boldsymbol u}",
                            "bv": "{\\boldsymbol v}",
                            "bw": "{\\boldsymbol w}"
                        }
                    }, after() {
                        console.log("渲染完成");
                    }
                });
            },
            //渲染文章大纲
            async renderOutline(md) {
                console.log("开始渲染大纲");
                let outlineElement = document.getElementById("outline");
                let html = await Vditor.md2html(md);
                outlineElement.innerHTML = html;
                Vditor.outlineRender(outlineElement, outlineElement);
                console.log("大纲渲染完成");
                if (outlineElement.innerHTML === "" || outlineElement.innerText === "") {
                    this.flag = false;
                }
            }
        },
        watch: {
            item: {
                //开启深度监控
                deep: true,
                handler(obj) {
                    this.renderMarkdown(obj.content);
                    this.renderOutline(obj.content);
                }
            }
        },
        created() {
            this.getDetails();
        },
        mounted() {
            document.getElementById('EditorPreview').innerHTML = "loading...";
        }
    })
</script>
</body>
</html>
